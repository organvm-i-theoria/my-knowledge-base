<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Knowledge Base Explorer</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
  <!-- Theme toggle -->
  <div class="theme-toggle">
    <button id="themeToggle" title="Toggle dark mode (T)">
      <span id="themeIcon">ðŸŒ™</span>
    </button>
    <button id="shortcutsBtn" title="Keyboard shortcuts (?)">
      <span>âŒ¨</span>
    </button>
  </div>

  <!-- Keyboard shortcuts modal -->
  <div id="shortcutsModal" class="shortcuts-modal">
    <div class="shortcuts-content">
      <h2>
        Keyboard Shortcuts
        <span class="close-shortcuts">&times;</span>
      </h2>
      <div class="shortcut-list">
        <div class="shortcut-item">
          <span class="shortcut-key"><kbd>Ctrl</kbd><kbd>K</kbd></span>
          <span class="shortcut-action">Focus search</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key"><kbd>/</kbd></span>
          <span class="shortcut-action">Focus search (alternative)</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key"><kbd>Esc</kbd></span>
          <span class="shortcut-action">Close modal / Clear suggestions</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key"><kbd>T</kbd></span>
          <span class="shortcut-action">Toggle dark mode</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key"><kbd>?</kbd></span>
          <span class="shortcut-action">Show this help</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key"><kbd>G</kbd> <kbd>R</kbd></span>
          <span class="shortcut-action">Go to Results tab</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key"><kbd>G</kbd> <kbd>G</kbd></span>
          <span class="shortcut-action">Go to Graph tab</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key"><kbd>G</kbd> <kbd>T</kbd></span>
          <span class="shortcut-action">Go to Tags tab</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key"><kbd>G</kbd> <kbd>A</kbd></span>
          <span class="shortcut-action">Go to Admin tab</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast notifications container -->
  <div id="toastContainer" class="toast-container"></div>

  <div class="page">
    <header class="page-header">
      <div class="title-block">
        <span class="eyebrow">Knowledge Base</span>
        <h1>ðŸ§  Knowledge Base Explorer</h1>
        <p class="subtitle">Search, map, and browse your knowledge artifacts from one workspace.</p>
      </div>
      <div id="stats" class="stats"></div>
    </header>

    <main>
      <section class="search-panel">
        <div class="search-box">
          <div class="search-input-wrap">
            <input
              type="text"
              id="searchInput"
              placeholder="Search insights, code, or decisions..."
              autocomplete="off"
            />
            <div id="searchSuggestions" class="search-suggestions"></div>
          </div>
          <button id="searchBtn" class="btn-primary">Search</button>
        </div>

        <div class="search-controls">
          <div class="search-mode">
            <label>
              <input type="radio" name="searchMode" value="fts" checked> FTS (Fast)
            </label>
            <label>
              <input type="radio" name="searchMode" value="semantic"> Semantic
            </label>
            <label>
              <input type="radio" name="searchMode" value="hybrid"> Hybrid
            </label>
          </div>

          <div class="search-options" id="hybridOptions" style="display: none;">
            <label>
              FTS Weight
              <input type="range" id="ftsWeight" min="0" max="1" step="0.1" value="0.4">
              <span id="ftsWeightValue">0.4</span>
            </label>
            <label>
              Semantic Weight
              <input type="range" id="semanticWeight" min="0" max="1" step="0.1" value="0.6">
              <span id="semanticWeightValue">0.6</span>
            </label>
          </div>
        </div>

        <div class="filter-panel">
          <div class="filter-group">
            <label>
              Type
              <select id="filterType">
                <option value="all">All types</option>
              </select>
            </label>
            <label>
              Category
              <select id="filterCategory">
                <option value="all">All categories</option>
              </select>
            </label>
            <label>
              Tag
              <input id="filterTag" list="tagOptions" placeholder="Filter by tag">
              <datalist id="tagOptions"></datalist>
            </label>
          </div>
          <div class="filter-group">
            <label>
              Min Score
              <input type="number" id="filterScore" min="0" max="1" step="0.05" placeholder="0.2">
            </label>
            <label>
              Sort
              <select id="filterSort">
                <option value="relevance">Relevance</option>
                <option value="recent">Most recent</option>
                <option value="title">Title Aâ†’Z</option>
              </select>
            </label>
            <label>
              Limit
              <input type="number" id="searchLimit" min="5" max="200" step="5" value="20">
            </label>
            <button id="clearFilters" class="btn-ghost">Clear Filters</button>
          </div>
        </div>
      </section>

      <div class="tabs">
        <button class="tab-btn active" data-tab="results">Search Results</button>
        <button class="tab-btn" data-tab="graph">Knowledge Graph</button>
        <button class="tab-btn" data-tab="tags">Browse by Tags</button>
        <button class="tab-btn" data-tab="conversations">Conversations</button>
        <button class="tab-btn" data-tab="admin">Admin Dashboard</button>
      </div>

      <section id="results-tab" class="tab-content active">
        <div id="resultsSummary" class="results-summary"></div>
        <div id="searchResults" class="results-grid"></div>
      </section>

      <section id="graph-tab" class="tab-content">
        <div class="graph-controls">
          <button id="loadGraphBtn" class="btn-secondary">Load Graph</button>
          <label>
            Limit
            <input type="number" id="graphLimit" value="50" min="10" max="200" step="10">
          </label>
          <label>
            Type
            <select id="graphType">
              <option value="">All types</option>
            </select>
          </label>
          <label>
            Category
            <select id="graphCategory">
              <option value="">All categories</option>
            </select>
          </label>
          <label>
            Focus ID
            <input type="text" id="graphFocusId" placeholder="unit-123">
          </label>
          <label>
            Hops
            <input type="number" id="graphHops" value="1" min="1" max="3" step="1">
          </label>
        </div>
        <div id="graphContainer" class="graph-container"></div>
      </section>

      <section id="tags-tab" class="tab-content">
        <div class="tag-toolbar">
          <input type="text" id="tagSearchInput" placeholder="Search tags...">
          <button id="refreshTagsBtn" class="btn-ghost">Refresh</button>
        </div>
        <div id="tagsContainer" class="tags-container"></div>
      </section>

      <section id="conversations-tab" class="tab-content">
        <div id="conversationsContainer" class="conversations-container"></div>
      </section>

      <section id="admin-tab" class="tab-content">
        <div class="export-panel">
          <h3>Export Data</h3>
          <div class="export-controls">
            <label>
              Data Source
              <select id="exportSource">
                <option value="results">Current Search Results</option>
                <option value="all">All Units (max 1000)</option>
              </select>
            </label>
            <label>
              Format
              <select id="exportFormat">
                <option value="json">JSON</option>
                <option value="csv">CSV</option>
                <option value="markdown">Markdown</option>
                <option value="html">HTML (Styled)</option>
                <option value="jsonld">JSON-LD</option>
                <option value="ndjson">NDJSON</option>
              </select>
            </label>
            <button id="exportBtn" class="btn-primary">Export</button>
          </div>
          <div id="exportStatus" class="export-status"></div>
        </div>

        <div class="wordcloud-container">
          <h3>Knowledge Word Cloud</h3>
          <div class="wordcloud-controls">
            <label>
              Source
              <select id="wordcloudSource">
                <option value="both">Tags & Keywords</option>
                <option value="tags">Tags Only</option>
                <option value="keywords">Keywords Only</option>
              </select>
            </label>
            <label>
              Limit
              <select id="wordcloudLimit">
                <option value="50">50 words</option>
                <option value="100" selected>100 words</option>
                <option value="200">200 words</option>
              </select>
            </label>
            <button id="refreshWordcloudBtn" class="btn-ghost">Refresh</button>
          </div>
          <div id="wordcloud" class="wordcloud">
            <div class="loading">Loading word cloud...</div>
          </div>
        </div>

        <div id="adminDashboard" class="admin-dashboard"></div>
      </section>
    </main>

    <div id="unitModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <div id="unitDetail"></div>
      </div>
    </div>
  </div>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="/js/app.js"></script>
</body>
</html>
